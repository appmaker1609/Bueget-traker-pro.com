<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6505998695940796"
     crossorigin="anonymous"></script>
  <meta name="google-site-verification" content="JCOjsLsaT71NWnYoJc3DcYZh-cmg2lo7YU4HhP8sHH0" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker - Smart Money Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4C4BCB'
                    }
                }
            }
        }
    </script>
    <style>
        .hide { display: none !important; }
        .fade-in { animation: fadeIn 0.2s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        input:focus { outline: none; }
        .transaction-item { transition: all 0.15s ease; }
        .transaction-item:hover { transform: translateY(-1px); }
        .calculator-btn { transition: all 0.1s ease; }
        .calculator-btn:hover { transform: scale(1.05); }
        .calculator-btn:active { transform: scale(0.95); }
        .tab-btn.active {
            background-color: #5D5CDE;
            color: white;
            box-shadow: 0 2px 8px rgba(93, 92, 222, 0.3);
        }
        .tab-btn {
            color: #6B7280;
            background-color: transparent;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 0;
        }
        .tab-btn:hover:not(.active) {
            background-color: #F3F4F6;
            color: #374151;
        }
        .dark .tab-btn:hover:not(.active) {
            background-color: #4B5563;
            color: #D1D5DB;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #5D5CDE 0%, #4C4BCB 100%);
        }
        .card-hover {
            transition: all 0.2s ease;
        }
        .card-hover:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .dark .card-hover:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(2.4); opacity: 0; }
        }
        .emoji-bounce {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }
        .tab-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2px;
        }
        @media (max-width: 640px) {
            .tab-btn span:last-child {
                font-size: 0.65rem;
            }
        }
        .health-score {
            background: linear-gradient(45deg, #10B981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .alert-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .budget-warning {
            border-left: 4px solid #F59E0B;
        }
        .budget-danger {
            border-left: 4px solid #EF4444;
        }
        .compact-header {
            min-height: 3rem;
        }
        .compact-card {
            padding: 0.75rem;
        }
        .mini-card {
            padding: 0.5rem;
        }
        .tight-spacing {
            gap: 0.5rem;
        }
        .ultra-compact {
            padding: 0.25rem 0.5rem;
        }
        .summary-card {
            min-height: 4rem;
        }
        .stat-card {
            min-height: 3.5rem;
        }
        .theme-toggle {
            transition: all 0.3s ease;
        }
        .theme-toggle:hover {
            transform: scale(1.1);
        }
        .vertical-layout {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .bill-reminder-active {
            animation: pulse 2s infinite;
            border: 2px solid #F59E0B;
        }
        .notification-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideInRight 0.5s ease;
            max-width: 300px;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .bill-due-today {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            animation: billAlert 1s ease-in-out infinite alternate;
        }
        @keyframes billAlert {
            from { box-shadow: 0 0 10px rgba(255, 107, 107, 0.5); }
            to { box-shadow: 0 0 20px rgba(255, 107, 107, 0.8); }
        }
        .photo-thumbnail {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .photo-thumbnail:hover {
            transform: scale(1.1);
        }
        .photo-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .photo-modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <!-- Compact Header Navigation -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-40 compact-header">
        <div class="px-3 py-1.5">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <div class="bg-white bg-opacity-20 p-1 rounded-lg">
                        <span class="text-lg emoji-bounce">üí∞</span>
                    </div>
                    <div>
                        <h1 id="appTitle" class="text-sm font-bold leading-tight">Budget Tracker Pro</h1>
                        <p id="appSubtitle" class="text-xs text-white text-opacity-70 leading-tight">Advanced Money Management</p>
                    </div>
                </div>
                <div class="flex items-center space-x-1">
                    <!-- Health Score Badge -->
                    <div id="healthScoreBadge" class="bg-white bg-opacity-20 px-2 py-0.5 rounded-full text-xs font-bold">
                        üíö <span id="healthScore">85</span>
                    </div>
                    <!-- Theme Toggle -->
                    <button id="themeToggle" class="theme-toggle p-1 bg-white bg-opacity-20 rounded-md hover:bg-opacity-30 transition-all">
                        <i id="themeIcon" class="fas fa-moon text-xs"></i>
                    </button>
                    <!-- Language Switcher -->
                    <select id="languageSelect" class="bg-white bg-opacity-20 text-white text-xs rounded-md p-1 border-0 min-w-0">
                        <option value="en">üá∫üá∏</option>
                        <option value="ne">üá≥üáµ</option>
                    </select>
                    <button id="calculatorBtn" class="p-1 bg-white bg-opacity-20 rounded-md hover:bg-opacity-30 transition-all">
                        <i class="fas fa-calculator text-xs"></i>
                    </button>
                    <button id="searchBtn" class="p-1 bg-white bg-opacity-20 rounded-md hover:bg-opacity-30 transition-all">
                        <i class="fas fa-search text-xs"></i>
                    </button>
                    <button id="menuBtn" class="p-1 bg-white bg-opacity-20 rounded-md hover:bg-opacity-30 transition-all">
                        <i class="fas fa-ellipsis-v text-xs"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Search Bar -->
        <div id="searchBar" class="px-3 pb-2 hide">
            <div class="relative">
                <input type="text" id="searchInput" class="w-full px-3 py-1 pl-7 bg-white bg-opacity-20 rounded-md text-white placeholder-white placeholder-opacity-70 border border-white border-opacity-30 focus:border-opacity-50 text-sm" placeholder="Search transactions...">
                <i class="fas fa-search absolute left-2 top-1.5 text-white text-opacity-70 text-xs"></i>
            </div>
        </div>

        <!-- Smart Insights Alert -->
        <div id="smartInsights" class="px-3 pb-1 hide">
            <div class="bg-yellow-500 bg-opacity-20 border border-yellow-400 rounded-md p-2 alert-pulse">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-lightbulb text-yellow-300 text-xs"></i>
                    <span id="insightText" class="text-xs font-medium"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Menu Dropdown -->
    <div id="menuDropdown" class="hide fixed top-12 right-4 bg-white dark:bg-gray-800 rounded-xl shadow-xl z-50 min-w-44">
        <div class="py-1">
            <button id="exportBtn" class="w-full px-3 py-1.5 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2 text-sm">
                <i class="fas fa-download text-xs"></i>
                <span id="exportText">Export Data</span>
            </button>
            <button id="importBtn" class="w-full px-3 py-1.5 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2 text-sm">
                <i class="fas fa-upload text-xs"></i>
                <span id="importText">Import Data</span>
            </button>
            <button id="backupBtn" class="w-full px-3 py-1.5 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2 text-sm">
                <i class="fas fa-cloud-upload-alt text-xs"></i>
                <span id="backupText">Backup to Cloud</span>
            </button>
            <button id="privacyBtn" class="w-full px-3 py-1.5 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2 text-sm">
                <i class="fas fa-shield-alt text-xs"></i>
                <span id="privacyText">Privacy Policy</span>
            </button>
            <button id="aboutBtn" class="w-full px-3 py-1.5 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2 text-sm">
                <i class="fas fa-info-circle text-xs"></i>
                <span id="aboutText">About</span>
            </button>
        </div>
    </div>

    <!-- Compact Tab Navigation -->
    <div class="bg-white dark:bg-gray-800 px-2 py-1.5 shadow border-b border-gray-200 dark:border-gray-600 sticky top-12 z-30">
        <div class="flex justify-between items-center">
            <div class="tab-container bg-gray-100 dark:bg-gray-900 p-0.5 rounded-lg shadow-inner w-full max-w-lg">
                <button id="dashboardTab" class="tab-btn active px-1 py-1 rounded-md text-xs font-medium flex flex-col items-center">
                    <span class="text-sm">üìä</span><span id="dashboardTabText" class="leading-tight">Dashboard</span>
                </button>
                <button id="transactionsTab" class="tab-btn px-1 py-1 rounded-md text-xs font-medium flex flex-col items-center">
                    <span class="text-sm">üí≥</span><span id="transactionsTabText" class="leading-tight">Transactions</span>
                </button>
                <button id="budgetTab" class="tab-btn px-1 py-1 rounded-md text-xs font-medium flex flex-col items-center">
                    <span class="text-sm">üìã</span><span id="budgetTabText" class="leading-tight">Budget</span>
                </button>
                <button id="analyticsTab" class="tab-btn px-1 py-1 rounded-md text-xs font-medium flex flex-col items-center">
                    <span class="text-sm">üìà</span><span id="analyticsTabText" class="leading-tight">Analytics</span>
                </button>
                <button id="advancedTab" class="tab-btn px-1 py-1 rounded-md text-xs font-medium flex flex-col items-center">
                    <span class="text-sm">‚ö°</span><span id="advancedTabText" class="leading-tight">Advanced</span>
                </button>
            </div>
            <div class="ml-2 flex flex-col space-y-1 vertical-layout">
                <select id="dateRangeFilter" class="px-2 py-1 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-xs">
                    <option value="all">All Time</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="quarter">This Quarter</option>
                    <option value="year">This Year</option>
                    <option value="custom">Custom Range</option>
                </select>
                <select id="sortBy" class="px-2 py-1 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-xs">
                    <option value="date">Sort by Date</option>
                    <option value="amount">Sort by Amount</option>
                    <option value="category">Sort by Category</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="p-2 pb-32">
        <!-- Dashboard Tab -->
        <div id="dashboardContent" class="tab-content">
            <div class="space-y-2">
                <!-- Financial Health Score -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 compact-card rounded-xl border border-green-200 dark:border-green-800 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-green-700 dark:text-green-300 text-sm font-bold mb-1">Financial Health Score</h3>
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl font-bold health-score" id="healthScoreDisplay">85</div>
                                <div>
                                    <div class="w-20 bg-green-200 dark:bg-green-800 rounded-full h-2">
                                        <div id="healthScoreBar" class="bg-green-600 h-2 rounded-full transition-all duration-300" style="width: 85%"></div>
                                    </div>
                                    <p id="healthScoreText" class="text-xs text-green-600 dark:text-green-400 mt-1">Excellent</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-3xl">üíö</div>
                    </div>
                </div>

                <!-- Summary Cards in Single Row -->
                <div class="grid grid-cols-3 gap-1 sm:gap-2">
                    <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-2 rounded-lg border border-green-200 dark:border-green-800 card-hover">
                        <div class="text-center">
                            <div class="text-lg text-green-600 mb-1">üí∞</div>
                            <h3 id="totalIncomeLabel" class="text-green-700 dark:text-green-300 text-xs font-medium leading-tight">Total Income</h3>
                            <p id="totalIncome" class="text-sm sm:text-base font-bold text-green-800 dark:text-green-200">$0.00</p>
                            <p id="incomeChange" class="text-xs text-green-600 dark:text-green-400 leading-tight">+0%</p>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 p-2 rounded-lg border border-red-200 dark:border-red-800 card-hover">
                        <div class="text-center">
                            <div class="text-lg text-red-600 mb-1">üí∏</div>
                            <h3 id="totalExpensesLabel" class="text-red-700 dark:text-red-300 text-xs font-medium leading-tight">Total Expenses</h3>
                            <p id="totalExpenses" class="text-sm sm:text-base font-bold text-red-800 dark:text-red-200">$0.00</p>
                            <p id="expenseChange" class="text-xs text-red-600 dark:text-red-400 leading-tight">+0%</p>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-2 rounded-lg border border-blue-200 dark:border-blue-800 card-hover">
                        <div class="text-center">
                            <div class="text-lg text-blue-600 mb-1">üè¶</div>
                            <h3 id="netBalanceLabel" class="text-blue-700 dark:text-blue-300 text-xs font-medium leading-tight">Net Balance</h3>
                            <p id="netBalance" class="text-sm sm:text-base font-bold text-blue-800 dark:text-blue-200">$0.00</p>
                            <p id="balanceChange" class="text-xs text-blue-600 dark:text-blue-400 leading-tight">+0%</p>
                        </div>
                    </div>
                </div>

                <!-- Bill Reminders -->
                <div id="billRemindersSection" class="bg-orange-50 dark:bg-orange-900/20 mini-card rounded-xl border border-orange-200 dark:border-orange-800 card-hover hide">
                    <h3 class="text-orange-700 dark:text-orange-300 text-sm font-semibold mb-2 flex items-center">
                        <span class="mr-2">‚è∞</span>Upcoming Bills
                    </h3>
                    <div id="upcomingBills" class="space-y-1"></div>
                </div>

                <!-- Budget Alerts -->
                <div id="budgetAlertsSection" class="space-y-1"></div>

                <!-- Recent Transactions -->
                <div class="bg-white dark:bg-gray-800 rounded-xl mini-card shadow-sm card-hover">
                    <h3 id="recentTransactionsLabel" class="text-sm font-semibold mb-2 flex items-center">
                        <span class="mr-2">üïí</span>Recent Transactions
                    </h3>
                    <div id="recentTransactions" class="space-y-1">
                        <p id="noTransactionsText" class="text-gray-500 dark:text-gray-400 text-center py-4">No transactions yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactionsContent" class="tab-content hide">
            <div class="space-y-2">
                <!-- Filter Controls -->
                <div class="bg-white dark:bg-gray-800 rounded-xl mini-card shadow-sm">
                    <div class="grid grid-cols-2 gap-2">
                        <select id="filterType" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            <option value="">All Types</option>
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                        </select>
                        <select id="filterCategory" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="mt-2 flex space-x-2">
                        <button id="recurringTransactionsBtn" class="flex-1 px-3 py-1.5 bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300 rounded-lg border border-purple-300 dark:border-purple-700 hover:bg-purple-200 dark:hover:bg-purple-900/40 transition-colors text-sm">
                            <i class="fas fa-sync-alt mr-2"></i>Recurring
                        </button>
                        <button id="addRecurringBtn" class="flex-1 px-3 py-1.5 bg-indigo-100 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300 rounded-lg border border-indigo-300 dark:border-indigo-700 hover:bg-indigo-200 dark:hover:bg-indigo-900/40 transition-colors text-sm">
                            <i class="fas fa-plus mr-2"></i>Add Recurring
                        </button>
                    </div>
                </div>

                <!-- Transactions List -->
                <div id="transactionsList" class="space-y-1">
                    <p class="text-gray-500 dark:text-gray-400 text-center py-8">No transactions found</p>
                </div>
            </div>
        </div>

        <!-- Budget Tab -->
        <div id="budgetContent" class="tab-content hide">
            <div class="space-y-3">
                <!-- Budget Overview -->
                <div class="bg-white dark:bg-gray-800 rounded-xl mini-card shadow-sm card-hover">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-sm font-semibold">üìä Budget Overview</h3>
                        <button id="addBudgetBtn" class="px-3 py-1.5 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm">
                            <i class="fas fa-plus mr-1"></i>Add Budget
                        </button>
                    </div>
                    <div id="budgetList" class="space-y-2">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-4">No budgets set yet</p>
                    </div>
                </div>

                <!-- Spending by Category -->
                <div class="bg-white dark:bg-gray-800 rounded-xl mini-card shadow-sm card-hover">
                    <h3 class="text-sm font-semibold mb-3">üí∞ Spending by Category</h3>
                    <div class="relative" style="height: 200px;">
                        <canvas id="spendingChart" class="w-full h-full"></canvas>
                        <div id="noSpendingData" class="absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400 hide">
                            <div class="text-center">
                                <i class="fas fa-chart-bar text-2xl mb-2"></i>
                                <p class="text-sm">No spending data for this month</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analyticsContent" class="tab-content hide">
            <div class="space-y-3">
                <!-- Quick Stats Cards -->
                <div class="grid grid-cols-2 gap-2">
                    <div class="bg-purple-50 dark:bg-purple-900/20 mini-card rounded-xl text-center border border-purple-200 dark:border-purple-800 card-hover stat-card">
                        <div class="text-lg mb-1">üìä</div>
                        <p id="totalTransactionsLabel" class="text-xs text-purple-700 dark:text-purple-300">Total Transactions</p>
                        <p id="totalTransactions" class="text-sm font-bold text-purple-800 dark:text-purple-200">0</p>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 mini-card rounded-xl text-center border border-yellow-200 dark:border-yellow-800 card-hover stat-card">
                        <div class="text-lg mb-1">üí∞</div>
                        <p id="avgDailySpendLabel" class="text-xs text-yellow-700 dark:text-yellow-300">Avg. Daily Spend</p>
                        <p id="avgDailySpend" class="text-sm font-bold text-yellow-800 dark:text-yellow-200">$0</p>
                    </div>
                    <div class="bg-indigo-50 dark:bg-indigo-900/20 mini-card rounded-xl text-center border border-indigo-200 dark:border-indigo-800 card-hover stat-card">
                        <div class="text-lg mb-1">üìà</div>
                        <p id="highestExpenseLabel" class="text-xs text-indigo-700 dark:text-indigo-300">Highest Expense</p>
                        <p id="highestExpense" class="text-sm font-bold text-indigo-800 dark:text-indigo-200">$0</p>
                    </div>
                    <div class="bg-pink-50 dark:bg-pink-900/20 mini-card rounded-xl text-center border border-pink-200 dark:border-pink-800 card-hover stat-card">
                        <div class="text-lg mb-1">üéØ</div>
                        <p id="savingsRateLabel" class="text-xs text-pink-700 dark:text-pink-300">Savings Rate</p>
                        <p id="savingsRate" class="text-sm font-bold text-pink-800 dark:text-pink-200">0%</p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="bg-white dark:bg-gray-800 rounded-xl mini-card shadow-sm card-hover">
                    <h3 id="monthlyTrendsLabel" class="text-sm font-semibold mb-3">üìà Monthly Trends</h3>
                    <div class="relative" style="height: 200px;">
                        <canvas id="trendsChart" class="w-full h-full"></canvas>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-xl mini-card shadow-sm card-hover">
                    <h3 id="categoryBreakdownLabel" class="text-sm font-semibold mb-3">üîÑ Category Breakdown</h3>
                    <div class="relative" style="height: 200px;">
                        <canvas id="categoryChart" class="w-full h-full"></canvas>
                    </div>
                </div>

                <!-- Investment Performance -->
                <div class="bg-white dark:bg-gray-800 rounded-xl mini-card shadow-sm card-hover">
                    <h3 class="text-sm font-semibold mb-3">üìä Investment Performance</h3>
                    <div class="relative" style="height: 200px;">
                        <canvas id="investmentChart" class="w-full h-full"></canvas>
                        <div id="noInvestmentData" class="absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400">
                            <div class="text-center">
                                <i class="fas fa-chart-line text-2xl mb-2"></i>
                                <p class="text-sm">No investment data available</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Tab -->
        <div id="advancedContent" class="tab-content hide">
            <div class="space-y-3">
                <!-- Investment Tracking -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl compact-card border border-blue-200 dark:border-blue-800 card-hover">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-sm font-semibold text-blue-800 dark:text-blue-200">üìà Investment Portfolio</h3>
                        <button id="addInvestmentBtn" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                            <i class="fas fa-plus mr-1"></i>Add Investment
                        </button>
                    </div>
                    <div id="investmentsList" class="space-y-2">
                        <p class="text-blue-600 dark:text-blue-400 text-center py-4">No investments tracked yet</p>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-3">
                        <div class="text-center">
                            <p class="text-xs text-blue-600 dark:text-blue-400">Total Invested</p>
                            <p id="totalInvested" class="text-sm font-bold text-blue-800 dark:text-blue-200">$0.00</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-blue-600 dark:text-blue-400">Current Value</p>
                            <p id="totalInvestmentValue" class="text-sm font-bold text-blue-800 dark:text-blue-200">$0.00</p>
                        </div>
                    </div>
                </div>

                <!-- Bill Reminders -->
                <div class="bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 rounded-xl compact-card border border-orange-200 dark:border-orange-800 card-hover">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-sm font-semibold text-orange-800 dark:text-orange-200">‚è∞ Bill Reminders</h3>
                        <button id="addBillReminderBtn" class="px-3 py-1.5 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm">
                            <i class="fas fa-plus mr-1"></i>Add Reminder
                        </button>
                    </div>
                    <div id="billRemindersList" class="space-y-2">
                        <p class="text-orange-600 dark:text-orange-400 text-center py-4">No bill reminders set</p>
                    </div>
                </div>

                <!-- Savings Goals -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl compact-card border border-green-200 dark:border-green-800 card-hover">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-sm font-semibold text-green-800 dark:text-green-200">üéØ Savings Goals</h3>
                        <button id="addGoalBtn" class="px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm">
                            <i class="fas fa-plus mr-1"></i>Add Goal
                        </button>
                    </div>
                    <div id="savingsGoalsList" class="space-y-3">
                        <p class="text-green-600 dark:text-green-400 text-center py-4">No savings goals set yet</p>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-900/20 dark:to-slate-900/20 rounded-xl compact-card border border-gray-200 dark:border-gray-800 card-hover">
                    <h3 class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-3">‚öôÔ∏è Data Management</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="clearAllDataBtn" class="px-3 py-1.5 bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 rounded-lg border border-red-300 dark:border-red-700 hover:bg-red-200 dark:hover:bg-red-900/40 transition-colors text-sm">
                            <i class="fas fa-trash mr-1"></i>Clear All Data
                        </button>
                        <button id="generateSampleBtn" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg border border-blue-300 dark:border-blue-700 hover:bg-blue-200 dark:hover:bg-blue-900/40 transition-colors text-sm">
                            <i class="fas fa-magic mr-1"></i>Sample Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculator Modal -->
    <div id="calculatorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 id="calculatorTitle" class="text-xl font-bold">Calculator</h2>
                <button id="closeCalculator" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-4">
                <input type="text" id="calculatorDisplay" class="w-full text-right text-2xl font-mono bg-transparent border-0 focus:outline-none" readonly value="0">
            </div>
            <div class="grid grid-cols-4 gap-2">
                <button class="calculator-btn bg-red-500 text-white p-3 rounded-lg font-semibold" onclick="clearCalculator()">C</button>
                <button class="calculator-btn bg-gray-300 dark:bg-gray-600 p-3 rounded-lg" onclick="deleteDigit()">‚å´</button>
                <button class="calculator-btn bg-blue-500 text-white p-3 rounded-lg" onclick="appendToDisplay('/')">/</button>
                <button class="calculator-btn bg-blue-500 text-white p-3 rounded-lg" onclick="appendToDisplay('*')">√ó</button>
                
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('7')">7</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('8')">8</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('9')">9</button>
                <button class="calculator-btn bg-blue-500 text-white p-3 rounded-lg" onclick="appendToDisplay('-')">-</button>
                
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('4')">4</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('5')">5</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('6')">6</button>
                <button class="calculator-btn bg-blue-500 text-white p-3 rounded-lg" onclick="appendToDisplay('+')">+</button>
                
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('1')">1</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('2')">2</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold" onclick="appendToDisplay('3')">3</button>
                <button class="calculator-btn bg-green-500 text-white p-3 rounded-lg row-span-2" onclick="calculate()">=</button>
                
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg font-semibold col-span-2" onclick="appendToDisplay('0')">0</button>
                <button class="calculator-btn bg-gray-200 dark:bg-gray-700 p-3 rounded-lg" onclick="appendToDisplay('.')">.</button>
            </div>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budgetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4 slide-up">
            <h2 id="budgetModalTitle" class="text-xl font-bold mb-4">Set Budget Limit</h2>
            <form id="budgetForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Category</label>
                    <select id="budgetCategory" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Monthly Limit</label>
                    <input type="number" id="budgetLimit" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="0.00" required>
                </div>
                <div class="flex space-x-3 pt-2">
                    <button type="button" id="cancelBudgetBtn" class="flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                    <button type="submit" id="saveBudgetBtn" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 id="privacyPolicyTitle" class="text-xl font-bold">Privacy Policy</h2>
                <button id="closePrivacy" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="privacyContent" class="prose dark:prose-invert max-w-none">
                <p>Your privacy is important to us. This application stores data locally on your device and does not share your financial information with third parties.</p>
                <h3>Data Collection</h3>
                <ul>
                    <li>Transaction data is stored locally in your browser</li>
                    <li>No personal information is transmitted to external servers</li>
                    <li>Analytics are computed locally on your device</li>
                </ul>
                <h3>Data Usage</h3>
                <ul>
                    <li>Your data is used solely for providing budget tracking features</li>
                    <li>Financial insights are generated locally</li>
                    <li>No data is sold or shared with advertisers</li>
                </ul>
                <h3>Data Security</h3>
                <p>All data is stored securely in your browser's local storage and is encrypted.</p>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm slide-up flex flex-col" style="max-height: 90vh;">
            <!-- Fixed Header -->
            <div class="p-4 pb-2 border-b border-gray-200 dark:border-gray-600 flex-shrink-0">
                <h2 id="modalTitle" class="text-xl font-bold">Add Transaction</h2>
            </div>
            
            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto p-4" style="min-height: 0;">
                <form id="transactionForm" class="space-y-4">
                    <div>
                        <label id="typeLabel" class="block text-sm font-medium mb-1">Type</label>
                        <select id="transactionType" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                            <option value="income">Income</option>
                            <option value="expense">Expense</option>
                        </select>
                    </div>
                    <div>
                        <label id="amountLabel" class="block text-sm font-medium mb-1">Amount</label>
                        <input type="number" id="transactionAmount" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="0.00" required>
                    </div>
                    <div>
                        <label id="categoryLabel" class="block text-sm font-medium mb-1">Category</label>
                        <select id="transactionCategory" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                        </select>
                    </div>
                    <div>
                        <label id="descriptionLabel" class="block text-sm font-medium mb-1">Description</label>
                        <input type="text" id="transactionDescription" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="Enter description">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">üì∑ Add Photo (Optional)</label>
                        <input type="file" id="transactionPhoto" accept="image/*" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        <div id="photoPreview" class="mt-2 hide">
                            <img id="previewImage" class="w-full h-24 object-cover rounded-lg border">
                            <button type="button" id="removePhoto" class="mt-1 text-xs text-red-500 hover:text-red-700">
                                <i class="fas fa-trash mr-1"></i>Remove Photo
                            </button>
                        </div>
                    </div>
                    <div class="pb-4">
                        <label id="dateLabel" class="block text-sm font-medium mb-1">Date</label>
                        <input type="date" id="transactionDate" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                    </div>
                </form>
            </div>
            
            <!-- Fixed Footer with Buttons -->
            <div class="p-4 pt-2 border-t border-gray-200 dark:border-gray-600 flex-shrink-0 bg-white dark:bg-gray-800 rounded-b-xl">
                <div class="flex space-x-3">
                    <button type="button" id="cancelBtn" class="flex-1 py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors font-medium">Cancel</button>
                    <button type="submit" id="saveBtn" form="transactionForm" class="flex-1 py-3 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors font-medium">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hide">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4">
            <h3 id="deleteTitle" class="text-lg font-semibold mb-4">Delete Transaction</h3>
            <p id="deleteMessage" class="text-gray-600 dark:text-gray-400 mb-6">Are you sure you want to delete this transaction? This action cannot be undone.</p>
            <div class="flex space-x-3">
                <button id="cancelDeleteBtn" class="flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                <button id="confirmDeleteBtn" class="flex-1 py-2 px-4 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">Delete</button>
            </div>
        </div>
    </div>

    <!-- Photo Modal -->
    <div id="photoModal" class="photo-modal hide" onclick="closePhotoModal()">
        <img id="modalPhoto" src="" alt="Transaction Photo">
        <button onclick="closePhotoModal()" class="absolute top-4 right-4 text-white text-2xl bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Floating Add Button -->
    <div class="fixed bottom-20 right-4 z-30">
        <button id="floatingAddBtn" class="bg-primary text-white w-12 h-12 rounded-full shadow-xl hover:bg-primary-dark transition-all transform hover:scale-110 flex items-center justify-center">
            <i class="fas fa-plus text-lg"></i>
        </button>
    </div>

    <!-- Footer -->
    <footer class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-300 dark:border-gray-600 shadow-lg">
        <div class="px-4 py-2">
            <div class="flex justify-between items-center">
                <!-- Quick Actions -->
                <div class="flex space-x-4">
                    <button id="quickAddIncome" class="flex flex-col items-center p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all group">
                        <div class="bg-green-500 p-1.5 rounded-full group-hover:scale-110 transition-transform">
                            <i class="fas fa-plus text-white text-xs"></i>
                        </div>
                        <span id="incomeText" class="text-xs text-green-600 dark:text-green-400 mt-1">Income</span>
                    </button>
                    <button id="quickAddExpense" class="flex flex-col items-center p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all group">
                        <div class="bg-red-500 p-1.5 rounded-full group-hover:scale-110 transition-transform">
                            <i class="fas fa-minus text-white text-xs"></i>
                        </div>
                        <span id="expenseText" class="text-xs text-red-600 dark:text-red-400 mt-1">Expense</span>
                    </button>
                </div>

                <!-- Balance Info -->
                <div class="text-center">
                    <p id="footerBalance" class="text-sm font-semibold text-gray-800 dark:text-gray-200">$0.00</p>
                    <p id="netBalanceFooterText" class="text-xs text-gray-500 dark:text-gray-500">Net Balance</p>
                </div>

                <!-- Made by Sagar -->
                <div class="text-right">
                    <p class="text-xs text-gray-600 dark:text-gray-400">Made with ‚ù§Ô∏è</p>
                    <p class="text-xs font-semibold text-primary">by Sagar</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Enhanced Dark mode setup with manual toggle
        let isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                isDarkMode = savedTheme === 'dark';
            }
            updateTheme();
        }
        
        function updateTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('themeIcon');
            
            if (isDarkMode) {
                html.classList.add('dark');
                themeIcon.className = 'fas fa-sun text-xs';
            } else {
                html.classList.remove('dark');
                themeIcon.className = 'fas fa-moon text-xs';
            }
            
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        }
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            updateTheme();
            // Redraw charts with new theme colors
            setTimeout(() => {
                if (charts.spending) updateSpendingChart();
                if (charts.trends) updateTrendsChart();
                if (charts.category) updateCategoryChart();
                if (charts.investment) updateInvestmentChart();
            }, 100);
        }
        
        // Initialize theme on load
        initTheme();

        // Enhanced App State
        let transactions = [];
        let recurringTransactions = [];
        let budgetLimits = {};
        let investments = [];
        let billReminders = [];
        let savingsGoals = [];
        let editingTransactionId = null;
        let editingRecurringId = null;
        let editingBudgetCategory = null;
        let charts = {};
        let currentLanguage = 'en';
        let currentCurrency = '$';

        // Enhanced Categories with Emojis
        const categories = {
            income: {
                en: ['üíº Salary', 'üíª Freelance', 'üìà Investment', 'üè¢ Business', 'üéÅ Gift', 'üí∞ Bonus', 'üè† Rental', 'üìö Royalty', 'üîÑ Other'],
                ne: ['üíº ‡§§‡§≤‡§¨', 'üíª ‡§∏‡•ç‡§µ‡§§‡§®‡•ç‡§§‡•ç‡§∞', 'üìà ‡§≤‡§ó‡§æ‡§®‡•Ä', 'üè¢ ‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞', 'üéÅ ‡§â‡§™‡§π‡§æ‡§∞', 'üí∞ ‡§¨‡•ã‡§®‡§∏', 'üè† ‡§≠‡§æ‡§°‡§æ', 'üìö ‡§∞‡•ã‡§Ø‡§≤‡•ç‡§ü‡•Ä', 'üîÑ ‡§Ö‡§®‡•ç‡§Ø']
            },
            expense: {
                en: ['üçï Food', 'üöó Transportation', 'üéÆ Entertainment', 'üõçÔ∏è Shopping', 'üí° Bills', 'üè• Healthcare', 'üìö Education', 'üëï Clothing', 'üè† Rent', '‚òï Coffee', '‚õΩ Fuel', 'üì± Phone', 'üîÑ Other'],
                ne: ['üçï ‡§ñ‡§æ‡§®‡§æ', 'üöó ‡§Ø‡§æ‡§§‡§æ‡§Ø‡§æ‡§§', 'üéÆ ‡§Æ‡§®‡•ã‡§∞‡§û‡•ç‡§ú‡§®', 'üõçÔ∏è ‡§ï‡§ø‡§®‡§Æ‡•á‡§≤', 'üí° ‡§¨‡§ø‡§ú‡•Å‡§≤‡•Ä', 'üè• ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø', 'üìö ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ', 'üëï ‡§≤‡•Å‡§ó‡§æ', 'üè† ‡§≠‡§æ‡§°‡§æ', '‚òï ‡§ï‡§´‡•Ä', '‚õΩ ‡§á‡§®‡•ç‡§ß‡§®', 'üì± ‡§´‡•ã‡§®', 'üîÑ ‡§Ö‡§®‡•ç‡§Ø']
            }
        };

        // Enhanced Translations
        const translations = {
            en: {
                appTitle: 'Budget Tracker Pro',
                appSubtitle: 'Advanced Money Management',
                dashboard: 'Dashboard',
                transactions: 'Transactions',
                budget: 'Budget',
                analytics: 'Analytics',
                advanced: 'Advanced',
                totalIncome: 'Total Income',
                totalExpenses: 'Total Expenses',
                netBalance: 'Net Balance',
                recentTransactions: 'Recent Transactions',
                noTransactions: 'No transactions yet',
                exportData: 'Export Data',
                importData: 'Import Data',
                backupToCloud: 'Backup to Cloud',
                privacyPolicy: 'Privacy Policy',
                about: 'About',
                calculator: 'Calculator',
                income: 'Income',
                expense: 'Expense',
                type: 'Type',
                amount: 'Amount',
                category: 'Category',
                description: 'Description',
                date: 'Date',
                cancel: 'Cancel',
                save: 'Save',
                delete: 'Delete',
                deleteTransaction: 'Delete Transaction',
                deleteConfirm: 'Are you sure you want to delete this transaction? This action cannot be undone.',
                addTransaction: 'Add Transaction',
                editTransaction: 'Edit Transaction',
                allTypes: 'All Types',
                allCategories: 'All Categories',
                sortByDate: 'Sort by Date',
                sortByAmount: 'Sort by Amount',
                sortByCategory: 'Sort by Category',
                totalTransactions: 'Total Transactions',
                avgDailySpend: 'Avg. Daily Spend',
                highestExpense: 'Highest Expense',
                savingsRate: 'Savings Rate',
                monthlyTrends: 'Monthly Trends',
                categoryBreakdown: 'Category Breakdown',
                searchPlaceholder: 'Search transactions...',
                netBalanceFooter: 'Net Balance',
                recurringTransactions: 'Recurring Transactions',
                addRecurring: 'Add Recurring',
                budgetOverview: 'Budget Overview',
                addBudget: 'Add Budget',
                setBudgetLimit: 'Set Budget Limit',
                monthlyLimit: 'Monthly Limit',
                investmentPortfolio: 'Investment Portfolio',
                addInvestment: 'Add Investment',
                billReminders: 'Bill Reminders',
                addReminder: 'Add Reminder',
                savingsGoals: 'Savings Goals',
                addGoal: 'Add Goal',
                dataManagement: 'Data Management',
                clearAllData: 'Clear All Data',
                generateSample: 'Sample Data'
            },
            ne: {
                appTitle: '‡§¨‡§ú‡•á‡§ü ‡§ü‡•ç‡§∞‡•ç‡§Ø‡§æ‡§ï‡§∞ ‡§™‡•ç‡§∞‡•ã',
                appSubtitle: '‡§â‡§®‡•ç‡§®‡§§ ‡§™‡•à‡§∏‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®',
                dashboard: '‡§°‡•ç‡§Ø‡§æ‡§∏‡§¨‡•ã‡§∞‡•ç‡§°',
                transactions: '‡§≤‡•á‡§®‡§¶‡•á‡§®',
                budget: '‡§¨‡§ú‡•á‡§ü',
                analytics: '‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£',
                advanced: '‡§â‡§®‡•ç‡§®‡§§',
                totalIncome: '‡§ï‡•Å‡§≤ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä',
                totalExpenses: '‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö',
                netBalance: '‡§∂‡•Å‡§¶‡•ç‡§ß ‡§¨‡§ö‡§§',
                recentTransactions: '‡§π‡§æ‡§≤‡§ï‡§æ ‡§≤‡•á‡§®‡§¶‡•á‡§®',
                noTransactions: '‡§Ö‡§π‡§ø‡§≤‡•á ‡§∏‡§Æ‡•ç‡§Æ ‡§ï‡•Å‡§®‡•à ‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§õ‡•à‡§®',
                exportData: '‡§°‡§æ‡§ü‡§æ ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§',
                importData: '‡§°‡§æ‡§ü‡§æ ‡§Ü‡§Ø‡§æ‡§§',
                backupToCloud: '‡§ï‡•ç‡§≤‡§æ‡§â‡§°‡§Æ‡§æ ‡§¨‡•ç‡§Ø‡§æ‡§ï‡§Ö‡§™',
                privacyPolicy: '‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ ‡§®‡•Ä‡§§‡§ø',
                about: '‡§¨‡§æ‡§∞‡•á‡§Æ‡§æ',
                calculator: '‡§ï‡•ç‡§Ø‡§æ‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞',
                income: '‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä',
                expense: '‡§ñ‡§∞‡•ç‡§ö',
                type: '‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',
                amount: '‡§∞‡§ï‡§Æ',
                category: '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä',
                description: '‡§µ‡§ø‡§µ‡§∞‡§£',
                date: '‡§Æ‡§ø‡§§‡§ø',
                cancel: '‡§∞‡§¶‡•ç‡§¶ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                save: '‡§∏‡•á‡§≠ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                delete: '‡§Æ‡•á‡§ü‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                deleteTransaction: '‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§Æ‡•á‡§ü‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                deleteConfirm: '‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç ‡§Ø‡•ã ‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§Æ‡•á‡§ü‡§æ‡§â‡§® ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•Å‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ? ‡§Ø‡•ã ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ó‡§∞‡•ç‡§® ‡§∏‡§ï‡§ø‡§Å‡§¶‡•à‡§®‡•§',
                addTransaction: '‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                editTransaction: '‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§∏‡§Æ‡•ç‡§™‡§æ‡§¶‡§® ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                allTypes: '‡§∏‡§¨‡•à ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',
                allCategories: '‡§∏‡§¨‡•à ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä',
                sortByDate: '‡§Æ‡§ø‡§§‡§ø ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ï‡•ç‡§∞‡§Æ‡§¨‡§¶‡•ç‡§ß',
                sortByAmount: '‡§∞‡§ï‡§Æ ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ï‡•ç‡§∞‡§Æ‡§¨‡§¶‡•ç‡§ß',
                sortByCategory: '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ï‡•ç‡§∞‡§Æ‡§¨‡§¶‡•ç‡§ß',
                totalTransactions: '‡§ï‡•Å‡§≤ ‡§≤‡•á‡§®‡§¶‡•á‡§®',
                avgDailySpend: '‡§î‡§∏‡§§ ‡§¶‡•à‡§®‡§ø‡§ï ‡§ñ‡§∞‡•ç‡§ö',
                highestExpense: '‡§∏‡§¨‡•à‡§≠‡§®‡•ç‡§¶‡§æ ‡§†‡•Ç‡§≤‡•ã ‡§ñ‡§∞‡•ç‡§ö',
                savingsRate: '‡§¨‡§ö‡§§ ‡§¶‡§∞',
                monthlyTrends: '‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§™‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø',
                categoryBreakdown: '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§µ‡§ø‡§≠‡§æ‡§ú‡§®',
                searchPlaceholder: '‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§ñ‡•ã‡§ú‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç...',
                netBalanceFooter: '‡§∂‡•Å‡§¶‡•ç‡§ß ‡§¨‡§ö‡§§',
                recurringTransactions: '‡§¶‡•ã‡§π‡•ã‡§∞‡§ø‡§®‡•á ‡§≤‡•á‡§®‡§¶‡•á‡§®',
                addRecurring: '‡§¶‡•ã‡§π‡•ã‡§∞‡§ø‡§®‡•á ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                budgetOverview: '‡§¨‡§ú‡•á‡§ü ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®',
                addBudget: '‡§¨‡§ú‡•á‡§ü ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                setBudgetLimit: '‡§¨‡§ú‡•á‡§ü ‡§∏‡•Ä‡§Æ‡§æ ‡§∏‡•á‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                monthlyLimit: '‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§∏‡•Ä‡§Æ‡§æ',
                investmentPortfolio: '‡§≤‡§ó‡§æ‡§®‡•Ä ‡§™‡•ã‡§∞‡•ç‡§ü‡§´‡•ã‡§≤‡§ø‡§Ø‡•ã',
                addInvestment: '‡§≤‡§ó‡§æ‡§®‡•Ä ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                billReminders: '‡§¨‡§ø‡§≤ ‡§∞‡§ø‡§Æ‡§æ‡§á‡§®‡•ç‡§°‡§∞',
                addReminder: '‡§∞‡§ø‡§Æ‡§æ‡§á‡§®‡•ç‡§°‡§∞ ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                savingsGoals: '‡§¨‡§ö‡§§ ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø',
                addGoal: '‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                dataManagement: '‡§°‡§æ‡§ü‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®',
                clearAllData: '‡§∏‡§¨‡•à ‡§°‡§æ‡§ü‡§æ ‡§π‡§ü‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç',
                generateSample: '‡§®‡§Æ‡•Ç‡§®‡§æ ‡§°‡§æ‡§ü‡§æ'
            }
        };

        // Bill Reminder System with Ringtone
        let billReminderAudio = null;
        let notificationPermission = false;

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadData();
            setupEventListeners();
            requestNotificationPermission();
            setupBillReminderAudio();
            updateLanguage();
            updateCategoryOptions();
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            updateAll();
            processRecurringTransactions();
            updateSmartInsights();
            startBillReminderCheck();
        }

        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    notificationPermission = permission === 'granted';
                });
            }
        }

        function setupBillReminderAudio() {
            // Create a ringtone using Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            function createRingtone() {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.4);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.6);
            }
            
            billReminderAudio = createRingtone;
        }

        function playBillReminderSound() {
            try {
                if (billReminderAudio) {
                    billReminderAudio();
                }
            } catch (error) {
                console.log('Audio playback failed:', error);
            }
        }

        function startBillReminderCheck() {
            checkBillReminders();
            // Check every minute
            setInterval(checkBillReminders, 60000);
        }

        function checkBillReminders() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            billReminders.forEach(bill => {
                const dueDate = new Date(bill.dueDate);
                const dueDateStr = dueDate.toISOString().split('T')[0];
                
                // Check if bill is due today
                if (dueDateStr === todayStr && !bill.notifiedToday) {
                    showBillReminderNotification(bill);
                    bill.notifiedToday = true;
                    saveData();
                }
                
                // Reset notification flag for new day
                if (dueDateStr !== todayStr) {
                    bill.notifiedToday = false;
                }
            });
        }

        function showBillReminderNotification(bill) {
            // Play ringtone
            playBillReminderSound();
            
            // Show browser notification
            if (notificationPermission) {
                const notification = new Notification('üí∏ Bill Reminder', {
                    body: `${bill.name} is due today! Amount: ${formatCurrency(bill.amount)}`,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üí∞</text></svg>',
                    requireInteraction: true
                });
                
                notification.onclick = function() {
                    window.focus();
                    showTab('advanced');
                    notification.close();
                };
            }
            
            // Show in-app notification popup
            showBillPopupNotification(bill);
            
            // Update UI to highlight due bill
            updateBillReminderUI();
        }

        function showBillPopupNotification(bill) {
            const popup = document.createElement('div');
            popup.className = 'notification-popup';
            popup.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">üîî</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-sm">Bill Reminder!</h4>
                        <p class="text-xs">${bill.name} is due today</p>
                        <p class="text-xs font-semibold">${formatCurrency(bill.amount)}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-2 flex space-x-2">
                    <button onclick="markBillAsPaid(${bill.id}); this.parentElement.parentElement.remove();" class="px-3 py-1 bg-white bg-opacity-20 rounded text-xs hover:bg-opacity-30">
                        Mark as Paid
                    </button>
                    <button onclick="snoozeBillReminder(${bill.id}); this.parentElement.parentElement.remove();" class="px-3 py-1 bg-white bg-opacity-20 rounded text-xs hover:bg-opacity-30">
                        Remind Later
                    </button>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.remove();
                }
            }, 10000);
        }

        function markBillAsPaid(billId) {
            const bill = billReminders.find(b => b.id === billId);
            if (bill) {
                // Add as expense transaction
                const transaction = {
                    id: Date.now(),
                    type: 'expense',
                    amount: bill.amount,
                    category: 'üí° Bills',
                    description: `${bill.name} (Bill Payment)`,
                    date: new Date().toISOString().split('T')[0],
                    timestamp: new Date()
                };
                
                transactions.push(transaction);
                
                // Update next due date if recurring
                if (bill.recurring) {
                    const nextMonth = new Date(bill.dueDate);
                    nextMonth.setMonth(nextMonth.getMonth() + 1);
                    bill.dueDate = nextMonth.toISOString().split('T')[0];
                    bill.notifiedToday = false;
                }
                
                updateAll();
                showNotification('Bill marked as paid and added to expenses!', 'success');
            }
        }

        function snoozeBillReminder(billId) {
            const bill = billReminders.find(b => b.id === billId);
            if (bill) {
                // Snooze for 1 hour
                bill.snoozeUntil = new Date(Date.now() + 60 * 60 * 1000);
                saveData();
                showNotification('Bill reminder snoozed for 1 hour', 'info');
            }
        }

        function updateBillReminderUI() {
            const today = new Date().toISOString().split('T')[0];
            const dueBills = billReminders.filter(bill => bill.dueDate === today);
            
            dueBills.forEach(bill => {
                // Add visual indicator to bill reminder in the list
                const billElements = document.querySelectorAll(`[data-bill-id="${bill.id}"]`);
                billElements.forEach(element => {
                    element.classList.add('bill-due-today');
                });
            });
        }

        function setupEventListeners() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Language switcher
            document.getElementById('languageSelect').addEventListener('change', (e) => {
                currentLanguage = e.target.value;
                currentCurrency = currentLanguage === 'ne' ? 'Rs.' : '$';
                updateLanguage();
                updateAll();
            });

            // Tab navigation
            document.getElementById('dashboardTab').addEventListener('click', () => showTab('dashboard'));
            document.getElementById('transactionsTab').addEventListener('click', () => showTab('transactions'));
            document.getElementById('budgetTab').addEventListener('click', () => showTab('budget'));
            document.getElementById('analyticsTab').addEventListener('click', () => showTab('analytics'));
            document.getElementById('advancedTab').addEventListener('click', () => showTab('advanced'));

            // Header buttons
            document.getElementById('floatingAddBtn').addEventListener('click', openAddModal);
            document.getElementById('searchBtn').addEventListener('click', toggleSearch);
            document.getElementById('menuBtn').addEventListener('click', toggleMenu);
            document.getElementById('calculatorBtn').addEventListener('click', openCalculator);
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // Menu dropdown
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importBtn').addEventListener('click', importData);
            document.getElementById('backupBtn').addEventListener('click', backupToCloud);
            document.getElementById('privacyBtn').addEventListener('click', openPrivacyModal);
            document.getElementById('aboutBtn').addEventListener('click', showAbout);

            // Footer quick actions
            document.getElementById('quickAddIncome').addEventListener('click', () => openQuickAddModal('income'));
            document.getElementById('quickAddExpense').addEventListener('click', () => openQuickAddModal('expense'));

            // Modal controls
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('transactionForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('transactionType').addEventListener('change', updateCategoryOptions);

            // Photo upload functionality
            document.getElementById('transactionPhoto').addEventListener('change', handlePhotoUpload);
            document.getElementById('removePhoto').addEventListener('click', removePhoto);

            // Budget controls
            document.getElementById('addBudgetBtn').addEventListener('click', openBudgetModal);
            document.getElementById('cancelBudgetBtn').addEventListener('click', closeBudgetModal);
            document.getElementById('budgetForm').addEventListener('submit', handleBudgetSubmit);

            // Advanced tab buttons
            document.getElementById('addInvestmentBtn').addEventListener('click', addInvestment);
            document.getElementById('addBillReminderBtn').addEventListener('click', addBillReminder);
            document.getElementById('addGoalBtn').addEventListener('click', addSavingsGoal);
            document.getElementById('clearAllDataBtn').addEventListener('click', clearAllData);
            document.getElementById('generateSampleBtn').addEventListener('click', generateSampleData);

            // Recurring transactions
            document.getElementById('recurringTransactionsBtn').addEventListener('click', showRecurringTransactions);
            document.getElementById('addRecurringBtn').addEventListener('click', addRecurringTransaction);

            // Calculator
            document.getElementById('closeCalculator').addEventListener('click', closeCalculator);

            // Privacy modal
            document.getElementById('closePrivacy').addEventListener('click', closePrivacyModal);

            // Filter and sort controls
            document.getElementById('filterType').addEventListener('change', updateTransactionsList);
            document.getElementById('filterCategory').addEventListener('change', updateTransactionsList);
            document.getElementById('sortBy').addEventListener('change', updateTransactionsList);
            document.getElementById('dateRangeFilter').addEventListener('change', updateTransactionsList);

            // Delete modal
            document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteModal);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);

            // Close modals on background click
            document.addEventListener('click', (e) => {
                if (e.target === document.getElementById('transactionModal')) closeModal();
                if (e.target === document.getElementById('deleteModal')) closeDeleteModal();
                if (e.target === document.getElementById('calculatorModal')) closeCalculator();
                if (e.target === document.getElementById('privacyModal')) closePrivacyModal();
                if (e.target === document.getElementById('budgetModal')) closeBudgetModal();
                if (!e.target.closest('#menuDropdown') && !e.target.closest('#menuBtn')) {
                    document.getElementById('menuDropdown').classList.add('hide');
                }
            });

            // Auto-save data when changes are made
            window.addEventListener('beforeunload', saveData);
        }

        // Photo Upload Functions
        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    showNotification('Photo size must be less than 5MB', 'warning');
                    e.target.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    const previewContainer = document.getElementById('photoPreview');
                    const previewImage = document.getElementById('previewImage');
                    
                    previewImage.src = event.target.result;
                    previewContainer.classList.remove('hide');
                };
                reader.readAsDataURL(file);
            }
        }

        function removePhoto() {
            document.getElementById('transactionPhoto').value = '';
            document.getElementById('photoPreview').classList.add('hide');
            document.getElementById('previewImage').src = '';
        }

        function openPhotoModal(photoSrc) {
            document.getElementById('modalPhoto').src = photoSrc;
            document.getElementById('photoModal').classList.remove('hide');
        }

        function closePhotoModal() {
            document.getElementById('photoModal').classList.add('hide');
        }

        // Data Management Functions
        function saveData() {
            try {
                const data = {
                    transactions,
                    recurringTransactions,
                    budgetLimits,
                    investments,
                    billReminders,
                    savingsGoals,
                    currentLanguage,
                    currentCurrency,
                    theme: isDarkMode ? 'dark' : 'light'
                };
                localStorage.setItem('budgetTrackerPro', JSON.stringify(data));
            } catch (error) {
                console.error('Failed to save data:', error);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('budgetTrackerPro');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    transactions = data.transactions || [];
                    recurringTransactions = data.recurringTransactions || [];
                    budgetLimits = data.budgetLimits || {};
                    investments = data.investments || [];
                    billReminders = data.billReminders || [];
                    savingsGoals = data.savingsGoals || [];
                    currentLanguage = data.currentLanguage || 'en';
                    currentCurrency = data.currentCurrency || '$';
                    
                    if (data.theme) {
                        isDarkMode = data.theme === 'dark';
                    }
                    
                    document.getElementById('languageSelect').value = currentLanguage;
                }
            } catch (error) {
                console.error('Failed to load data:', error);
            }
        }

        function clearAllData() {
            showConfirmDialog('Are you sure you want to clear all data? This action cannot be undone.', () => {
                transactions = [];
                recurringTransactions = [];
                budgetLimits = {};
                investments = [];
                billReminders = [];
                savingsGoals = [];
                saveData();
                updateAll();
                showNotification('All data cleared successfully!', 'success');
            });
        }

        function generateSampleData() {
            const sampleTransactions = [
                { id: Date.now() + 1, type: 'income', amount: 5000, category: 'üíº Salary', description: 'Monthly salary', date: '2024-01-01', timestamp: new Date() },
                { id: Date.now() + 2, type: 'expense', amount: 800, category: 'üè† Rent', description: 'Monthly rent', date: '2024-01-01', timestamp: new Date() },
                { id: Date.now() + 3, type: 'expense', amount: 150, category: 'üçï Food', description: 'Groceries', date: '2024-01-02', timestamp: new Date() },
                { id: Date.now() + 4, type: 'expense', amount: 50, category: '‚õΩ Fuel', description: 'Gas station', date: '2024-01-03', timestamp: new Date() },
                { id: Date.now() + 5, type: 'income', amount: 500, category: 'üíª Freelance', description: 'Web design project', date: '2024-01-05', timestamp: new Date() }
            ];

            const sampleBudgets = {
                'üçï Food': 500,
                'üöó Transportation': 300,
                'üéÆ Entertainment': 200,
                'üõçÔ∏è Shopping': 250
            };

            transactions.push(...sampleTransactions);
            budgetLimits = { ...budgetLimits, ...sampleBudgets };
            
            saveData();
            updateAll();
            showNotification('Sample data generated successfully!', 'success');
        }

        // Advanced Features Implementation
        function calculateFinancialHealthScore() {
            if (transactions.length === 0) return 50;

            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            let score = 50; // Base score

            // Savings rate (40% of score)
            const savingsRate = income > 0 ? ((income - expenses) / income) * 100 : 0;
            score += (savingsRate * 0.4);

            // Transaction consistency (20% of score)
            const recentTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return transactionDate >= thirtyDaysAgo;
            });
            
            if (recentTransactions.length > 0) {
                score += 20;
            }

            // Budget compliance (20% of score)
            const budgetCompliance = calculateBudgetCompliance();
            score += (budgetCompliance * 0.2);

            // Diversification (20% of score)
            const categories = [...new Set(transactions.map(t => t.category))];
            const diversificationScore = Math.min(categories.length * 5, 20);
            score += diversificationScore;

            return Math.max(0, Math.min(100, Math.round(score)));
        }

        function calculateBudgetCompliance() {
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthlyExpenses = {};

            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    monthlyExpenses[t.category] = (monthlyExpenses[t.category] || 0) + t.amount;
                });

            let totalCompliance = 0;
            let budgetCount = 0;

            Object.keys(budgetLimits).forEach(category => {
                const spent = monthlyExpenses[category] || 0;
                const limit = budgetLimits[category];
                const compliance = Math.max(0, 100 - ((spent / limit) * 100));
                totalCompliance += compliance;
                budgetCount++;
            });

            return budgetCount > 0 ? totalCompliance / budgetCount : 100;
        }

        function updateSmartInsights() {
            const insights = generateSmartInsights();
            const insightsContainer = document.getElementById('smartInsights');
            const insightText = document.getElementById('insightText');

            if (insights.length > 0) {
                insightText.textContent = insights[0];
                insightsContainer.classList.remove('hide');
            } else {
                insightsContainer.classList.add('hide');
            }
        }

        function generateSmartInsights() {
            const insights = [];
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            // Check budget overruns
            const monthlyExpenses = {};
            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    monthlyExpenses[t.category] = (monthlyExpenses[t.category] || 0) + t.amount;
                });

            Object.keys(budgetLimits).forEach(category => {
                const spent = monthlyExpenses[category] || 0;
                const limit = budgetLimits[category];
                const percentage = (spent / limit) * 100;

                if (percentage > 90) {
                    insights.push(`‚ö†Ô∏è You've spent ${percentage.toFixed(0)}% of your ${category} budget this month`);
                }
            });

            // Check spending patterns
            const lastWeekExpenses = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return t.type === 'expense' && transactionDate >= weekAgo;
            }).reduce((sum, t) => sum + t.amount, 0);

            const previousWeekExpenses = transactions.filter(t => {
                const transactionDate = new Date(t.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                return t.type === 'expense' && transactionDate >= twoWeeksAgo && transactionDate < weekAgo;
            }).reduce((sum, t) => sum + t.amount, 0);

            if (previousWeekExpenses > 0) {
                const changePercentage = ((lastWeekExpenses - previousWeekExpenses) / previousWeekExpenses) * 100;
                if (changePercentage > 25) {
                    insights.push(`üìà Your spending increased by ${changePercentage.toFixed(0)}% this week`);
                } else if (changePercentage < -25) {
                    insights.push(`üí∞ Great job! Your spending decreased by ${Math.abs(changePercentage).toFixed(0)}% this week`);
                }
            }

            return insights;
        }

        function processRecurringTransactions() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            recurringTransactions.forEach(recurring => {
                const lastProcessed = new Date(recurring.lastProcessed || recurring.startDate);
                const daysDiff = Math.floor((today - lastProcessed) / (1000 * 60 * 60 * 24));

                let shouldProcess = false;
                switch (recurring.frequency) {
                    case 'daily':
                        shouldProcess = daysDiff >= 1;
                        break;
                    case 'weekly':
                        shouldProcess = daysDiff >= 7;
                        break;
                    case 'monthly':
                        shouldProcess = daysDiff >= 30;
                        break;
                    case 'yearly':
                        shouldProcess = daysDiff >= 365;
                        break;
                }

                if (shouldProcess) {
                    const transaction = {
                        id: Date.now() + Math.random(),
                        type: recurring.type,
                        amount: recurring.amount,
                        category: recurring.category,
                        description: `${recurring.description} (Auto)`,
                        date: todayStr,
                        timestamp: new Date(),
                        isRecurring: true
                    };
                    
                    transactions.push(transaction);
                    recurring.lastProcessed = todayStr;
                    saveData();
                }
            });
        }

        function updateAll() {
            updateDashboard();
            updateTransactionsList();
            updateBudgetOverview();
            updateAnalytics();
            updateAnalyticsStats();
            updateFooterBalance();
            updateFinancialHealthScore();
            updateBillReminders();
            updateBudgetAlerts();
            updateSmartInsights();
            saveData();
        }

        function updateFinancialHealthScore() {
            const score = calculateFinancialHealthScore();
            document.getElementById('healthScore').textContent = score;
            document.getElementById('healthScoreDisplay').textContent = score;
            document.getElementById('healthScoreBar').style.width = `${score}%`;
            
            let healthText = 'Poor';
            if (score >= 80) healthText = 'Excellent';
            else if (score >= 60) healthText = 'Good';
            else if (score >= 40) healthText = 'Fair';
            
            document.getElementById('healthScoreText').textContent = healthText;
        }

        function updateBudgetAlerts() {
            const alertsContainer = document.getElementById('budgetAlertsSection');
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthlyExpenses = {};

            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    monthlyExpenses[t.category] = (monthlyExpenses[t.category] || 0) + t.amount;
                });

            const alerts = [];
            Object.keys(budgetLimits).forEach(category => {
                const spent = monthlyExpenses[category] || 0;
                const limit = budgetLimits[category];
                const percentage = (spent / limit) * 100;

                if (percentage > 100) {
                    alerts.push({
                        category,
                        percentage,
                        type: 'danger',
                        message: `${category} budget exceeded by ${formatCurrency(spent - limit)}`
                    });
                } else if (percentage > 80) {
                    alerts.push({
                        category,
                        percentage,
                        type: 'warning',
                        message: `${category} budget is ${percentage.toFixed(0)}% used`
                    });
                }
            });

            if (alerts.length > 0) {
                alertsContainer.innerHTML = alerts.map(alert => `
                    <div class="bg-white dark:bg-gray-800 mini-card rounded-xl border-l-4 ${alert.type === 'danger' ? 'border-red-500' : 'border-yellow-500'} card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium text-sm ${alert.type === 'danger' ? 'text-red-600' : 'text-yellow-600'}">${alert.message}</p>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-2">
                                    <div class="${alert.type === 'danger' ? 'bg-red-500' : 'bg-yellow-500'} h-1.5 rounded-full transition-all duration-300" style="width: ${Math.min(alert.percentage, 100)}%"></div>
                                </div>
                            </div>
                            <div class="text-xl">${alert.type === 'danger' ? 'üö®' : '‚ö†Ô∏è'}</div>
                        </div>
                    </div>
                `).join('');
                alertsContainer.classList.remove('hide');
            } else {
                alertsContainer.classList.add('hide');
            }
        }

        // Fixed Spending Chart Function
        function updateSpendingChart() {
            const canvas = document.getElementById('spendingChart');
            const noDataDiv = document.getElementById('noSpendingData');
            
            if (!canvas) return;

            try {
                if (charts.spending) {
                    charts.spending.destroy();
                    delete charts.spending;
                }

                const currentMonth = new Date().toISOString().substring(0, 7);
                const categoryData = {};
                
                // Get all expense transactions for current month
                const monthlyExpenses = transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth));
                
                monthlyExpenses.forEach(t => {
                    categoryData[t.category] = (categoryData[t.category] || 0) + t.amount;
                });

                // Show no data message if empty
                if (Object.keys(categoryData).length === 0) {
                    noDataDiv.classList.remove('hide');
                    canvas.style.display = 'none';
                    return;
                }

                noDataDiv.classList.add('hide');
                canvas.style.display = 'block';

                const labels = Object.keys(categoryData);
                const spentData = Object.values(categoryData);
                const budgetData = labels.map(category => budgetLimits[category] || 0);

                const ctx = canvas.getContext('2d');
                charts.spending = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Spent',
                            data: spentData,
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Budget',
                            data: budgetData,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                    font: { size: 10 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { 
                                    color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                    font: { size: 10 },
                                    callback: function(value) {
                                        return formatCurrency(value);
                                    }
                                },
                                grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                            },
                            x: {
                                ticks: { 
                                    color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                    font: { size: 10 },
                                    maxRotation: 45
                                },
                                grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error updating spending chart:', error);
                noDataDiv.classList.remove('hide');
                canvas.style.display = 'none';
            }
        }

        // All other existing functions with enhancements...
        function formatCurrency(amount) {
            return currentLanguage === 'ne' ? `Rs.${amount.toFixed(2)}` : `$${amount.toFixed(2)}`;
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hide'));
            document.getElementById(tabName + 'Content').classList.remove('hide');

            if (tabName === 'analytics') {
                setTimeout(updateAnalytics, 100);
            } else if (tabName === 'budget') {
                setTimeout(() => {
                    updateBudgetOverview();
                    updateSpendingChart();
                }, 100);
            }
        }

        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // Update UI text
            document.getElementById('appTitle').textContent = t.appTitle;
            document.getElementById('appSubtitle').textContent = t.appSubtitle;
            document.getElementById('dashboardTabText').textContent = t.dashboard;
            document.getElementById('transactionsTabText').textContent = t.transactions;
            document.getElementById('budgetTabText').textContent = t.budget;
            document.getElementById('analyticsTabText').textContent = t.analytics;
            document.getElementById('advancedTabText').textContent = t.advanced;
            
            // Update all other UI elements as before...
            updateSelectOptions();
        }

        function updateSelectOptions() {
            const t = translations[currentLanguage];
            
            // Update transaction type options
            const typeSelect = document.getElementById('transactionType');
            typeSelect.innerHTML = `
                <option value="income">${t.income}</option>
                <option value="expense">${t.expense}</option>
            `;
            
            // Update filter type options
            const filterType = document.getElementById('filterType');
            filterType.innerHTML = `
                <option value="">${t.allTypes}</option>
                <option value="income">${t.income}</option>
                <option value="expense">${t.expense}</option>
            `;
            
            updateCategoryOptions();
        }

        function updateCategoryOptions() {
            const type = document.getElementById('transactionType').value;
            const categorySelect = document.getElementById('transactionCategory');
            const filterCategorySelect = document.getElementById('filterCategory');
            const budgetCategorySelect = document.getElementById('budgetCategory');
            
            // Update transaction category
            categorySelect.innerHTML = '';
            categories[type][currentLanguage].forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });

            // Update filter categories
            const t = translations[currentLanguage];
            filterCategorySelect.innerHTML = `<option value="">${t.allCategories}</option>`;
            Object.values(categories).forEach(typeCategories => {
                typeCategories[currentLanguage].forEach(category => {
                    if (!filterCategorySelect.querySelector(`option[value="${category}"]`)) {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        filterCategorySelect.appendChild(option);
                    }
                });
            });

            // Update budget categories (only expense categories)
            if (budgetCategorySelect) {
                budgetCategorySelect.innerHTML = '';
                categories.expense[currentLanguage].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    budgetCategorySelect.appendChild(option);
                });
            }
        }

        // Budget Management Functions
        function openBudgetModal() {
            updateCategoryOptions();
            document.getElementById('budgetModal').classList.remove('hide');
        }

        function closeBudgetModal() {
            document.getElementById('budgetModal').classList.add('hide');
            editingBudgetCategory = null;
        }

        function handleBudgetSubmit(e) {
            e.preventDefault();
            
            const category = document.getElementById('budgetCategory').value;
            const limit = parseFloat(document.getElementById('budgetLimit').value);
            
            budgetLimits[category] = limit;
            closeBudgetModal();
            updateBudgetOverview();
            updateSpendingChart();
            showNotification('Budget limit set successfully!', 'success');
        }

        function updateBudgetOverview() {
            const budgetList = document.getElementById('budgetList');
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            const monthlyExpenses = {};
            transactions.filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    monthlyExpenses[t.category] = (monthlyExpenses[t.category] || 0) + t.amount;
                });

            if (Object.keys(budgetLimits).length === 0) {
                budgetList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">No budgets set yet</p>';
                return;
            }

            budgetList.innerHTML = Object.keys(budgetLimits).map(category => {
                const limit = budgetLimits[category];
                const spent = monthlyExpenses[category] || 0;
                const percentage = (spent / limit) * 100;
                const remaining = limit - spent;

                return `
                    <div class="bg-gray-50 dark:bg-gray-700 mini-card rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-medium text-sm">${category}</h4>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs ${percentage > 100 ? 'text-red-600' : percentage > 80 ? 'text-yellow-600' : 'text-green-600'}">
                                    ${formatCurrency(spent)} / ${formatCurrency(limit)}
                                </span>
                                <button onclick="deleteBudget('${category}')" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                            <div class="${percentage > 100 ? 'bg-red-500' : percentage > 80 ? 'bg-yellow-500' : 'bg-green-500'} h-2 rounded-full transition-all duration-300" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <div class="flex justify-between text-xs mt-1">
                            <span class="${remaining >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${remaining >= 0 ? 'Remaining' : 'Over budget'}: ${formatCurrency(Math.abs(remaining))}
                            </span>
                            <span class="text-gray-500">${percentage.toFixed(1)}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteBudget(category) {
            showConfirmDialog(`Delete budget for ${category}?`, () => {
                delete budgetLimits[category];
                updateBudgetOverview();
                updateSpendingChart();
                showNotification('Budget deleted successfully!', 'success');
            });
        }

        // Enhanced transaction functions with photo support...
        function openAddModal() {
            editingTransactionId = null;
            const t = translations[currentLanguage];
            document.getElementById('modalTitle').textContent = t.addTransaction;
            document.getElementById('transactionForm').reset();
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            removePhoto(); // Clear any previous photo
            updateCategoryOptions();
            document.getElementById('transactionModal').classList.remove('hide');
        }

        function openEditModal(transaction) {
            editingTransactionId = transaction.id;
            const t = translations[currentLanguage];
            document.getElementById('modalTitle').textContent = t.editTransaction;
            document.getElementById('transactionType').value = transaction.type;
            document.getElementById('transactionAmount').value = transaction.amount;
            document.getElementById('transactionDescription').value = transaction.description;
            document.getElementById('transactionDate').value = transaction.date;
            updateCategoryOptions();
            document.getElementById('transactionCategory').value = transaction.category;
            
            // Handle existing photo
            if (transaction.photo) {
                document.getElementById('previewImage').src = transaction.photo;
                document.getElementById('photoPreview').classList.remove('hide');
            } else {
                removePhoto();
            }
            
            document.getElementById('transactionModal').classList.remove('hide');
        }

        function closeModal() {
            document.getElementById('transactionModal').classList.add('hide');
            editingTransactionId = null;
            removePhoto();
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = {
                type: document.getElementById('transactionType').value,
                amount: parseFloat(document.getElementById('transactionAmount').value),
                category: document.getElementById('transactionCategory').value,
                description: document.getElementById('transactionDescription').value,
                date: document.getElementById('transactionDate').value
            };

            // Add photo if exists
            const previewImage = document.getElementById('previewImage');
            if (previewImage.src && !previewImage.src.includes('data:')) {
                // If it's an existing photo (not base64), keep the current photo
                if (editingTransactionId) {
                    const existingTransaction = transactions.find(t => t.id === editingTransactionId);
                    if (existingTransaction && existingTransaction.photo) {
                        formData.photo = existingTransaction.photo;
                    }
                }
            } else if (previewImage.src) {
                formData.photo = previewImage.src;
            }

            if (editingTransactionId) {
                updateTransaction(editingTransactionId, formData);
            } else {
                addTransaction(formData);
            }

            closeModal();
        }

        function addTransaction(data) {
            const transaction = {
                id: Date.now(),
                ...data,
                timestamp: new Date()
            };
            transactions.push(transaction);
            updateAll();
            showNotification(translations[currentLanguage].income === data.type ? 'Income added!' : 'Expense added!', 'success');
        }

        function updateTransaction(id, data) {
            const index = transactions.findIndex(t => t.id === id);
            if (index !== -1) {
                transactions[index] = { ...transactions[index], ...data };
                updateAll();
                showNotification('Transaction updated!', 'success');
            }
        }

        function deleteTransaction(id) {
            transactions = transactions.filter(t => t.id !== id);
            updateAll();
            showNotification('Transaction deleted!', 'success');
        }

        function openDeleteModal(transactionId) {
            document.getElementById('deleteModal').classList.remove('hide');
            document.getElementById('confirmDeleteBtn').onclick = () => {
                deleteTransaction(transactionId);
                closeDeleteModal();
            };
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hide');
        }

        function confirmDelete() {
            closeDeleteModal();
        }

        function updateDashboard() {
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expenses;

            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpenses').textContent = formatCurrency(expenses);
            document.getElementById('netBalance').textContent = formatCurrency(balance);

            // Calculate month-over-month changes
            const lastMonth = new Date();
            lastMonth.setMonth(lastMonth.getMonth() - 1);
            const lastMonthStr = lastMonth.toISOString().substring(0, 7);
            
            const lastMonthIncome = transactions.filter(t => t.type === 'income' && t.date.startsWith(lastMonthStr)).reduce((sum, t) => sum + t.amount, 0);
            const lastMonthExpenses = transactions.filter(t => t.type === 'expense' && t.date.startsWith(lastMonthStr)).reduce((sum, t) => sum + t.amount, 0);
            
            const incomeChange = lastMonthIncome > 0 ? ((income - lastMonthIncome) / lastMonthIncome * 100) : 0;
            const expenseChange = lastMonthExpenses > 0 ? ((expenses - lastMonthExpenses) / lastMonthExpenses * 100) : 0;

            document.getElementById('incomeChange').textContent = `${incomeChange >= 0 ? '+' : ''}${incomeChange.toFixed(1)}%`;
            document.getElementById('expenseChange').textContent = `${expenseChange >= 0 ? '+' : ''}${expenseChange.toFixed(1)}%`;
            document.getElementById('balanceChange').textContent = `${incomeChange >= expenseChange ? '+' : ''}${(incomeChange - expenseChange).toFixed(1)}%`;

            const recent = transactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            const recentContainer = document.getElementById('recentTransactions');
            if (recent.length === 0) {
                recentContainer.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center py-4">${translations[currentLanguage].noTransactions}</p>`;
            } else {
                recentContainer.innerHTML = recent.map(transaction => `
                    <div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded-lg transition-all hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center space-x-2">
                            ${transaction.photo ? `<img src="${transaction.photo}" class="photo-thumbnail" onclick="openPhotoModal('${transaction.photo}')">` : ''}
                            <div>
                                <p class="font-medium text-sm">${transaction.description || transaction.category}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">${transaction.date} ‚Ä¢ ${transaction.category}</p>
                            </div>
                        </div>
                        <span class="font-bold text-sm ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                            ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount).replace(currentCurrency, '')}
                        </span>
                    </div>
                `).join('');
            }
        }

        function getFilteredTransactions() {
            const typeFilter = document.getElementById('filterType').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            const dateRange = document.getElementById('dateRangeFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            let filtered = [...transactions];

            // Apply filters
            if (typeFilter) {
                filtered = filtered.filter(t => t.type === typeFilter);
            }
            if (categoryFilter) {
                filtered = filtered.filter(t => t.category === categoryFilter);
            }

            // Apply date range filter
            if (dateRange !== 'all') {
                const now = new Date();
                let startDate;

                switch (dateRange) {
                    case 'week':
                        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                    case 'quarter':
                        startDate = new Date(now.getFullYear(), Math.floor(now.getMonth() / 3) * 3, 1);
                        break;
                    case 'year':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        break;
                }

                if (startDate) {
                    filtered = filtered.filter(t => new Date(t.date) >= startDate);
                }
            }

            // Apply sorting
            switch (sortBy) {
                case 'amount':
                    filtered.sort((a, b) => b.amount - a.amount);
                    break;
                case 'category':
                    filtered.sort((a, b) => a.category.localeCompare(b.category));
                    break;
                default:
                    filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            }

            return filtered;
        }

        function updateTransactionsList() {
            const filtered = getFilteredTransactions();
            const container = document.getElementById('transactionsList');
            
            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No transactions found</p>';
            } else {
                container.innerHTML = filtered.map(transaction => `
                    <div class="transaction-item bg-white dark:bg-gray-800 mini-card rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center space-x-2 flex-1">
                                ${transaction.photo ? `<img src="${transaction.photo}" class="photo-thumbnail" onclick="openPhotoModal('${transaction.photo}')">` : ''}
                                <div class="flex-1">
                                    <h4 class="font-medium text-sm">${transaction.description || transaction.category}</h4>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">${transaction.date} ‚Ä¢ ${transaction.category}</p>
                                    ${transaction.isRecurring ? '<span class="text-xs bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 px-2 py-1 rounded">Recurring</span>' : ''}
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-sm ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                    ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                                </span>
                                <div class="flex space-x-1">
                                    <button onclick="openEditModal(${JSON.stringify(transaction).replace(/"/g, '&quot;')})" class="p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded">
                                        <i class="fas fa-edit text-xs"></i>
                                    </button>
                                    <button onclick="openDeleteModal(${transaction.id})" class="p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded">
                                        <i class="fas fa-trash text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateAnalytics() {
            updateTrendsChart();
            updateCategoryChart();
            updateInvestmentChart();
        }

        function updateTrendsChart() {
            const ctx = document.getElementById('trendsChart').getContext('2d');
            
            if (charts.trends) {
                charts.trends.destroy();
            }

            const monthlyData = {};
            const filtered = getFilteredTransactions();
            
            filtered.forEach(t => {
                const month = t.date.substring(0, 7);
                if (!monthlyData[month]) {
                    monthlyData[month] = { income: 0, expenses: 0 };
                }
                monthlyData[month][t.type === 'income' ? 'income' : 'expenses'] += t.amount;
            });

            const months = Object.keys(monthlyData).sort();
            const incomeData = months.map(m => monthlyData[m].income);
            const expenseData = months.map(m => monthlyData[m].expenses);

            const t = translations[currentLanguage];
            charts.trends = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: t.income,
                        data: incomeData,
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: t.expense,
                        data: expenseData,
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                font: { size: 10 }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { 
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                font: { size: 10 }
                            },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        },
                        x: {
                            ticks: { 
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                font: { size: 10 }
                            },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        }
                    }
                }
            });
        }

        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            if (charts.category) {
                charts.category.destroy();
            }

            const categoryData = {};
            const filtered = getFilteredTransactions().filter(t => t.type === 'expense');
            
            filtered.forEach(t => {
                categoryData[t.category] = (categoryData[t.category] || 0) + t.amount;
            });

            const labels = Object.keys(categoryData);
            const data = Object.values(categoryData);

            charts.category = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#EF4444', '#F97316', '#F59E0B', '#EAB308',
                            '#84CC16', '#22C55E', '#10B981', '#14B8A6',
                            '#06B6D4', '#0EA5E9', '#3B82F6', '#6366F1',
                            '#8B5CF6', '#A855F7', '#C026D3', '#DB2777'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                padding: 10,
                                usePointStyle: true,
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });
        }

        function updateInvestmentChart() {
            const ctx = document.getElementById('investmentChart');
            const noDataDiv = document.getElementById('noInvestmentData');
            
            if (!ctx) return;

            if (investments.length === 0) {
                noDataDiv.style.display = 'flex';
                ctx.style.display = 'none';
                return;
            }

            noDataDiv.style.display = 'none';
            ctx.style.display = 'block';

            if (charts.investment) {
                charts.investment.destroy();
            }

            const labels = investments.map(inv => inv.name);
            const investedData = investments.map(inv => inv.amount);
            const currentData = investments.map(inv => inv.currentValue);

            charts.investment = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Invested',
                        data: investedData,
                        backgroundColor: 'rgba(59, 130, 246, 0.8)'
                    }, {
                        label: 'Current Value',
                        data: currentData,
                        backgroundColor: 'rgba(16, 185, 129, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                font: { size: 10 }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { 
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                font: { size: 10 }
                            },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        },
                        x: {
                            ticks: { 
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#000',
                                font: { size: 10 }
                            },
                            grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#E5E7EB' }
                        }
                    }
                }
            });
        }

        function updateAnalyticsStats() {
            const filtered = getFilteredTransactions();
            document.getElementById('totalTransactions').textContent = filtered.length;
            
            const expenses = filtered.filter(t => t.type === 'expense');
            const avgDaily = expenses.length > 0 ? 
                expenses.reduce((sum, t) => sum + t.amount, 0) / expenses.length : 0;
            document.getElementById('avgDailySpend').textContent = formatCurrency(avgDaily).replace('.00', '');
            
            const highestExpense = expenses.length > 0 ? 
                Math.max(...expenses.map(t => t.amount)) : 0;
            document.getElementById('highestExpense').textContent = formatCurrency(highestExpense).replace('.00', '');
            
            const income = filtered.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0);
            const savingsRate = income > 0 ? ((income - totalExpenses) / income * 100) : 0;
            document.getElementById('savingsRate').textContent = `${Math.max(0, savingsRate).toFixed(1)}%`;
        }

        function updateBillReminders() {
            const container = document.getElementById('upcomingBills');
            const section = document.getElementById('billRemindersSection');
            
            if (!container || billReminders.length === 0) {
                if (section) section.classList.add('hide');
                return;
            }

            const today = new Date();
            const upcoming = billReminders.filter(bill => {
                const dueDate = new Date(bill.dueDate);
                const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                return daysDiff >= 0 && daysDiff <= 7;
            });

            if (upcoming.length === 0) {
                section.classList.add('hide');
                return;
            }

            section.classList.remove('hide');
            container.innerHTML = upcoming.map(bill => {
                const dueDate = new Date(bill.dueDate);
                const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="flex justify-between items-center p-2 bg-orange-100 dark:bg-orange-900/20 rounded-lg">
                        <div>
                            <p class="font-medium text-sm">${bill.name}</p>
                            <p class="text-xs text-orange-600 dark:text-orange-400">Due ${daysDiff === 0 ? 'today' : `in ${daysDiff} day${daysDiff > 1 ? 's' : ''}`}</p>
                        </div>
                        <span class="font-bold text-sm text-orange-700 dark:text-orange-300">${formatCurrency(bill.amount)}</span>
                    </div>
                `;
            }).join('');
        }

        function updateFooterBalance() {
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expenses;
            document.getElementById('footerBalance').textContent = formatCurrency(balance);
        }

        // Advanced Feature Functions
        function addInvestment() {
            showPromptDialog('Investment Name:', 'Stocks', (name) => {
                if (!name) return;
                showPromptDialog('Initial Investment Amount:', '', (amount) => {
                    if (!amount) return;
                    showPromptDialog('Current Value:', amount, (currentValue) => {
                        if (!currentValue) return;
                        
                        const investment = {
                            id: Date.now(),
                            name,
                            amount: parseFloat(amount),
                            currentValue: parseFloat(currentValue),
                            date: new Date().toISOString().split('T')[0]
                        };
                        
                        investments.push(investment);
                        updateInvestmentsList();
                        updateAll();
                        showNotification('Investment added successfully!', 'success');
                    });
                });
            });
        }

        function updateInvestmentsList() {
            const container = document.getElementById('investmentsList');
            const totalInvestedEl = document.getElementById('totalInvested');
            const totalValueEl = document.getElementById('totalInvestmentValue');
            
            if (investments.length === 0) {
                container.innerHTML = '<p class="text-blue-600 dark:text-blue-400 text-center py-4">No investments tracked yet</p>';
                totalInvestedEl.textContent = formatCurrency(0);
                totalValueEl.textContent = formatCurrency(0);
                return;
            }

            const totalInvested = investments.reduce((sum, inv) => sum + inv.amount, 0);
            const totalValue = investments.reduce((sum, inv) => sum + inv.currentValue, 0);
            
            totalInvestedEl.textContent = formatCurrency(totalInvested);
            totalValueEl.textContent = formatCurrency(totalValue);

            container.innerHTML = investments.map(investment => {
                const gain = investment.currentValue - investment.amount;
                const gainPercentage = (gain / investment.amount) * 100;
                
                return `
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-medium text-sm">${investment.name}</h4>
                                <p class="text-xs text-blue-600 dark:text-blue-400">${formatCurrency(investment.amount)} ‚Üí ${formatCurrency(investment.currentValue)}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-sm ${gain >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${gain >= 0 ? '+' : ''}${formatCurrency(gain)}
                                </p>
                                <p class="text-xs ${gain >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${gainPercentage >= 0 ? '+' : ''}${gainPercentage.toFixed(1)}%
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addBillReminder() {
            showPromptDialog('Bill Name:', 'Electric Bill', (name) => {
                if (!name) return;
                showPromptDialog('Amount:', '', (amount) => {
                    if (!amount) return;
                    showPromptDialog('Due Date (YYYY-MM-DD):', '', (dueDate) => {
                        if (!dueDate) return;
                        
                        const reminder = {
                            id: Date.now(),
                            name,
                            amount: parseFloat(amount),
                            dueDate,
                            recurring: true
                        };
                        
                        billReminders.push(reminder);
                        updateBillRemindersList();
                        updateAll();
                        showNotification('Bill reminder added successfully!', 'success');
                    });
                });
            });
        }

        function updateBillRemindersList() {
            const container = document.getElementById('billRemindersList');
            
            if (billReminders.length === 0) {
                container.innerHTML = '<p class="text-orange-600 dark:text-orange-400 text-center py-4">No bill reminders set</p>';
                return;
            }

            container.innerHTML = billReminders.map(reminder => `
                <div class="bg-orange-50 dark:bg-orange-900/20 p-2 rounded-lg">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-medium text-sm">${reminder.name}</h4>
                            <p class="text-xs text-orange-600 dark:text-orange-400">Due: ${reminder.dueDate}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-sm text-orange-700 dark:text-orange-300">${formatCurrency(reminder.amount)}</p>
                            <button onclick="deleteBillReminder(${reminder.id})" class="text-red-500 hover:text-red-700 text-xs">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteBillReminder(id) {
            billReminders = billReminders.filter(r => r.id !== id);
            updateBillRemindersList();
            updateAll();
            showNotification('Bill reminder deleted!', 'success');
        }

        function addSavingsGoal() {
            showPromptDialog('Goal Name:', 'Emergency Fund', (name) => {
                if (!name) return;
                showPromptDialog('Target Amount:', '', (amount) => {
                    if (!amount) return;
                    showPromptDialog('Target Date (YYYY-MM-DD):', '', (targetDate) => {
                        if (!targetDate) return;
                        
                        const goal = {
                            id: Date.now(),
                            name,
                            targetAmount: parseFloat(amount),
                            currentAmount: 0,
                            targetDate,
                            createdDate: new Date().toISOString().split('T')[0]
                        };
                        
                        savingsGoals.push(goal);
                        updateSavingsGoalsList();
                        updateAll();
                        showNotification('Savings goal added successfully!', 'success');
                    });
                });
            });
        }

        function updateSavingsGoalsList() {
            const container = document.getElementById('savingsGoalsList');
            
            if (savingsGoals.length === 0) {
                container.innerHTML = '<p class="text-green-600 dark:text-green-400 text-center py-4">No savings goals set yet</p>';
                return;
            }

            container.innerHTML = savingsGoals.map(goal => {
                const progress = (goal.currentAmount / goal.targetAmount) * 100;
                const remaining = goal.targetAmount - goal.currentAmount;
                
                return `
                    <div class="bg-green-50 dark:bg-green-900/20 compact-card rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-medium text-sm">${goal.name}</h4>
                            <span class="text-xs text-green-600 dark:text-green-400">${formatCurrency(goal.currentAmount)} / ${formatCurrency(goal.targetAmount)}</span>
                        </div>
                        <div class="w-full bg-green-200 dark:bg-green-800 rounded-full h-2 mb-2">
                            <div class="bg-green-600 h-2 rounded-full transition-all duration-300" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span class="text-green-600 dark:text-green-400">Target: ${goal.targetDate}</span>
                            <span class="text-green-600 dark:text-green-400">${progress.toFixed(1)}% complete</span>
                        </div>
                        <div class="mt-2 flex space-x-1">
                            <button onclick="addToGoal(${goal.id})" class="text-xs bg-green-600 text-white px-2 py-1 rounded">Add Money</button>
                            <button onclick="deleteSavingsGoal(${goal.id})" class="text-xs bg-red-500 text-white px-2 py-1 rounded">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addToGoal(goalId) {
            showPromptDialog('Amount to add:', '', (amount) => {
                if (!amount) return;
                
                const goal = savingsGoals.find(g => g.id === goalId);
                if (goal) {
                    goal.currentAmount += parseFloat(amount);
                    updateSavingsGoalsList();
                    updateAll();
                    showNotification('Amount added to goal!', 'success');
                }
            });
        }

        function deleteSavingsGoal(id) {
            savingsGoals = savingsGoals.filter(g => g.id !== id);
            updateSavingsGoalsList();
            updateAll();
            showNotification('Savings goal deleted!', 'success');
        }

        // Recurring Transactions
        function showRecurringTransactions() {
            showCustomModal('Recurring Transactions', 
                recurringTransactions.length > 0 
                    ? recurringTransactions.map(r => `
                        <div class="flex justify-between items-center p-2 border-b">
                            <div>
                                <strong>${r.description}</strong><br>
                                <small>${r.frequency} - ${formatCurrency(r.amount)}</small>
                            </div>
                            <button onclick="deleteRecurring(${r.id})" class="text-red-500">Delete</button>
                        </div>
                    `).join('')
                    : '<p>No recurring transactions set up</p>'
            );
        }

        function addRecurringTransaction() {
            showPromptDialog('Transaction Description:', 'Monthly Salary', (description) => {
                if (!description) return;
                showPromptDialog('Amount:', '', (amount) => {
                    if (!amount) return;
                    showPromptDialog('Type (income/expense):', 'income', (type) => {
                        if (!type) return;
                        showPromptDialog('Frequency (daily/weekly/monthly/yearly):', 'monthly', (frequency) => {
                            if (!frequency) return;
                            
                            const recurring = {
                                id: Date.now(),
                                description,
                                amount: parseFloat(amount),
                                type,
                                frequency,
                                category: type === 'income' ? 'üíº Salary' : 'üè† Rent',
                                startDate: new Date().toISOString().split('T')[0],
                                lastProcessed: null
                            };
                            
                            recurringTransactions.push(recurring);
                            updateAll();
                            showNotification('Recurring transaction added!', 'success');
                        });
                    });
                });
            });
        }

        function deleteRecurring(id) {
            recurringTransactions = recurringTransactions.filter(r => r.id !== id);
            updateAll();
            showNotification('Recurring transaction deleted!', 'success');
        }

        // Import/Export Functions
        function exportData() {
            if (transactions.length === 0) {
                showNotification('No data to export', 'warning');
                return;
            }

            const data = {
                transactions,
                recurringTransactions,
                budgetLimits,
                investments,
                billReminders,
                savingsGoals,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `budget-tracker-pro-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Data exported successfully!', 'success');
            document.getElementById('menuDropdown').classList.add('hide');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.transactions) transactions = data.transactions;
                        if (data.recurringTransactions) recurringTransactions = data.recurringTransactions;
                        if (data.budgetLimits) budgetLimits = data.budgetLimits;
                        if (data.investments) investments = data.investments;
                        if (data.billReminders) billReminders = data.billReminders;
                        if (data.savingsGoals) savingsGoals = data.savingsGoals;
                        
                        updateAll();
                        showNotification('Data imported successfully!', 'success');
                    } catch (error) {
                        showNotification('Invalid file format', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
            document.getElementById('menuDropdown').classList.add('hide');
        }

        function backupToCloud() {
            showNotification('Cloud backup feature coming soon!', 'info');
            document.getElementById('menuDropdown').classList.add('hide');
        }

        // Calculator Functions
        function openCalculator() {
            document.getElementById('calculatorModal').classList.remove('hide');
            clearCalculator();
        }

        function closeCalculator() {
            document.getElementById('calculatorModal').classList.add('hide');
        }

        function appendToDisplay(value) {
            const display = document.getElementById('calculatorDisplay');
            if (display.value === '0' && value !== '.') {
                display.value = value;
            } else {
                display.value += value;
            }
        }

        function clearCalculator() {
            document.getElementById('calculatorDisplay').value = '0';
        }

        function deleteDigit() {
            const display = document.getElementById('calculatorDisplay');
            if (display.value.length > 1) {
                display.value = display.value.slice(0, -1);
            } else {
                display.value = '0';
            }
        }

        function calculate() {
            const display = document.getElementById('calculatorDisplay');
            try {
                const result = eval(display.value.replace('√ó', '*'));
                display.value = result.toString();
            } catch (error) {
                display.value = 'Error';
                setTimeout(clearCalculator, 1500);
            }
        }

        // Menu Functions
        function toggleMenu() {
            document.getElementById('menuDropdown').classList.toggle('hide');
        }

        function openPrivacyModal() {
            document.getElementById('privacyModal').classList.remove('hide');
            document.getElementById('menuDropdown').classList.add('hide');
        }

        function closePrivacyModal() {
            document.getElementById('privacyModal').classList.add('hide');
        }

        function showAbout() {
            showCustomModal('About Budget Tracker Pro', `
                <div class="space-y-4">
                    <p><strong>Budget Tracker Pro v2.0</strong></p>
                    <p>A comprehensive financial management tool with advanced features.</p>
                    
                    <h3 class="font-semibold text-lg">üöÄ Advanced Features:</h3>
                    <ul class="space-y-1 text-sm">
                        <li>‚Ä¢ üí° Financial Health Score</li>
                        <li>‚Ä¢ üîÑ Recurring Transactions</li>
                        <li>‚Ä¢ üìä Budget Limits & Alerts</li>
                        <li>‚Ä¢ üìà Investment Tracking</li>
                        <li>‚Ä¢ ‚è∞ Bill Reminders</li>
                        <li>‚Ä¢ üéØ Multiple Savings Goals</li>
                        <li>‚Ä¢ üß† Smart Insights</li>
                        <li>‚Ä¢ üì± Multi-language Support</li>
                        <li>‚Ä¢ üåô Manual Dark/Light Mode Toggle</li>
                        <li>‚Ä¢ üíæ Data Import/Export</li>
                        <li>‚Ä¢ üì∑ Photo Upload for Transactions</li>
                        <li>‚Ä¢ üìê Advanced Layout Options</li>
                    </ul>
                    
                    <p class="text-center mt-4">
                        <strong>Made with ‚ù§Ô∏è by Sagar</strong><br>
                        <span class="text-sm text-gray-600">Advanced Personal Finance Management</span>
                    </p>
                </div>
            `);
            document.getElementById('menuDropdown').classList.add('hide');
        }

        function toggleSearch() {
            const searchBar = document.getElementById('searchBar');
            searchBar.classList.toggle('hide');
            if (!searchBar.classList.contains('hide')) {
                document.getElementById('searchInput').focus();
            }
        }

        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                const filtered = transactions.filter(t => 
                    (t.description && t.description.toLowerCase().includes(searchTerm)) ||
                    t.category.toLowerCase().includes(searchTerm) ||
                    t.amount.toString().includes(searchTerm)
                );
                displayFilteredTransactions(filtered);
            } else {
                updateTransactionsList();
            }
        }

        function displayFilteredTransactions(filtered) {
            const container = document.getElementById('transactionsList');
            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No transactions found</p>';
            } else {
                container.innerHTML = filtered.map(transaction => `
                    <div class="transaction-item bg-white dark:bg-gray-800 mini-card rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center space-x-2 flex-1">
                                ${transaction.photo ? `<img src="${transaction.photo}" class="photo-thumbnail" onclick="openPhotoModal('${transaction.photo}')">` : ''}
                                <div class="flex-1">
                                    <h4 class="font-medium text-sm">${transaction.description || transaction.category}</h4>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">${transaction.date} ‚Ä¢ ${transaction.category}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-sm ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                    ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                                </span>
                                <div class="flex space-x-1">
                                    <button onclick="openEditModal(${JSON.stringify(transaction).replace(/"/g, '&quot;')})" class="p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded">
                                        <i class="fas fa-edit text-xs"></i>
                                    </button>
                                    <button onclick="openDeleteModal(${transaction.id})" class="p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded">
                                        <i class="fas fa-trash text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function openQuickAddModal(type) {
            openAddModal();
            document.getElementById('transactionType').value = type;
            updateCategoryOptions();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 text-white max-w-sm ${
                type === 'success' ? 'bg-green-500' :
                type === 'warning' ? 'bg-yellow-500' :
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showCustomModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">${title}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="prose dark:prose-invert max-w-none">${content}</div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            const confirmBtn = document.createElement('button');
            confirmBtn.className = 'px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded';
            confirmBtn.textContent = 'Confirm';
            confirmBtn.onclick = () => {
                modal.remove();
                onConfirm();
            };
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded';
            cancelBtn.textContent = 'Cancel';
            cancelBtn.onclick = () => modal.remove();
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3" id="dialogButtons">
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const buttonsContainer = modal.querySelector('#dialogButtons');
            buttonsContainer.appendChild(cancelBtn);
            buttonsContainer.appendChild(confirmBtn);
        }

        function showPromptDialog(message, defaultValue, onSubmit) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = defaultValue || '';
            input.className = 'w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base mb-4';
            
            const okBtn = document.createElement('button');
            okBtn.className = 'px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded';
            okBtn.textContent = 'OK';
            okBtn.onclick = () => {
                const value = input.value.trim();
                modal.remove();
                if (value) onSubmit(value);
            };
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded';
            cancelBtn.textContent = 'Cancel';
            cancelBtn.onclick = () => modal.remove();
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    okBtn.click();
                }
            });
            
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div id="inputContainer"></div>
                    <div class="flex justify-end space-x-3" id="dialogButtons">
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const inputContainer = modal.querySelector('#inputContainer');
            const buttonsContainer = modal.querySelector('#dialogButtons');
            inputContainer.appendChild(input);
            buttonsContainer.appendChild(cancelBtn);
            buttonsContainer.appendChild(okBtn);
            input.focus();
        }
    </script>
</body>
</html>